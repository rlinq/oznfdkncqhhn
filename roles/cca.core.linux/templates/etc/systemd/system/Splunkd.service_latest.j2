#This unit file replaces the traditional start-up script for systemd
#configurations, and is used when enabling boot-start for Splunk on
#systemd-based Linux distributions.
#Managed by splunk_cca as a template file in Ansible

[Unit]
Description=Systemd service file for Splunk, generated by splunk_cca based on 'splunk enable boot-start'
After=network.target
StartLimitInterval=200
StartLimitBurst=5

[Service]
Type=simple
Restart=always
RestartSec=30
ExecStart={{ splunk_path }}/bin/splunk _internal_launch_under_systemd
KillMode=mixed
KillSignal=SIGINT
TimeoutStopSec=600
LimitNOFILE=65536
SuccessExitStatus=51 52
RestartPreventExitStatus=51
RestartForceExitStatus=52
User={{ splunk_user }}
Group=splunk
Delegate=true
CPUShares=1024
MemoryLimit={{ cca_splunk_systemd_memory_limit }}
PermissionsStartOnly=true
ExecStartPost=/bin/bash -c "chown -R {{ splunk_user }}:{{ splunk_user_group_name }} /sys/fs/cgroup/cpu/system.slice/%n"
ExecStartPost=/bin/bash -c "chown -R {{ splunk_user }}:{{ splunk_user_group_name }} /sys/fs/cgroup/memory/system.slice/%n"

[Install]
WantedBy=multi-user.target
